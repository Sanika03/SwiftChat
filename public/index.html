<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="stylesheet" type="text/css" href="styles.css">
  <title>SwiftChat</title>
</head>
<body>
  <div class="chat-app">
    <div class="sidebar">
      <div class="header">
        <h1>SwiftChat</h1>
        <!-- Display the list of online users -->
        <ul class="online-users">
          <!-- List items will be dynamically added here -->
        </ul>
      </div>
      <div class="contacts">
        <!-- ... Your existing contacts ... -->
      </div>
    </div>
    <div class="chat">
      <div class="header">
        <!-- Display the user's name above the chat messages -->
        <h2 id="user-name-display">Your Name</h2>
      </div>
      <div class="messages">
        <!-- Chat messages will be dynamically added here -->
      </div>
      <!-- New input field for user's name -->
      <div class="input-error" id="user-name-error">
        <p></p>
      </div>
      <input type="text" id="user-name" placeholder="Your Name">
      <!-- New input field for message -->
      <div class="input-error" id="message-error">
        <p></p>
      </div>
      <div class="input-area">
        <input type="text" id="message-input" placeholder="Type your message...">
        <button id="send-button">
          <i class="fas fa-paper-plane" style="color: #ffffff;"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Add the Socket.io script -->
  <!-- Your existing HTML code here -->

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  const userNameInput = document.getElementById('user-name');
  const messageInput = document.getElementById('message-input');
  const sendButton = document.getElementById('send-button');
  const messagesContainer = document.querySelector('.messages');
  const onlineUsersList = document.querySelector('.online-users');

  function updateUserNameDisplay(userName) {
    const userNameDisplay = document.getElementById('user-name-display');
    userNameDisplay.textContent = userName;
  }

  function displayErrorMessage(elementId, message) {
    const errorElement = document.getElementById(elementId);
    errorElement.textContent = message;
  }

  function clearErrorMessage(elementId) {
    const errorElement = document.getElementById(elementId);
    errorElement.textContent = '';
  }

  userNameInput.addEventListener('keydown', (event) => {
    if (event.key === 'Enter') {
      event.preventDefault();
      const userName = userNameInput.value.trim();
      if (userName !== '') {
        // Save the user's name
        updateUserNameDisplay(userName);

        // Remove cursor focus from the input
        userNameInput.blur();

        // Clear error message
        clearErrorMessage('user-name-error');
      } else {
        // Show error message
        displayErrorMessage('user-name-error', 'Please enter a name');
      }
    }
  });

  messageInput.addEventListener('keydown', (event) => {
    if (event.key === 'Enter') {
      event.preventDefault();
      const userName = userNameInput.value.trim();
      const message = messageInput.value.trim();
      
      if (message === '' && userName === '') {
        displayErrorMessage('message-error', 'Please type a message');
        displayErrorMessage('user-name-error', 'Please enter a name');
      } else if (message === '') {
        displayErrorMessage('message-error', 'Please type a message');
      } else {
        clearErrorMessage('message-error');
        sendMessage();
      }
    }
  });

  function sendMessage() {
    const userName = userNameInput.value.trim();
    const message = messageInput.value.trim();

    if (userName === '') {
      displayErrorMessage('user-name-error', 'Please enter a name');
      return;
    } else {
      clearErrorMessage('user-name-error');
    }

    if (message === '') {
      displayErrorMessage('message-error', 'Please type a message');
      return;
    } else {
      clearErrorMessage('message-error');
    }

    updateUserNameDisplay(userName);
    socket.emit('chat message', userName + ': ' + message);
    messageInput.value = '';
    messageInput.blur();
  }

  sendButton.addEventListener('click', sendMessage);

  socket.on('chat message', (msg) => {
    const messageElement = document.createElement('div');

    const formattedMessage = msg.replace(/(.*?):/, '<b>$1:</b>'); // Wrap userName in <b> element
    messageElement.innerHTML = formattedMessage;

    if (msg.startsWith(userNameInput.value.trim() + ': ')) {
      messageElement.classList.add('message', 'sent');
    } else {
      messageElement.classList.add('message', 'received');
    }

    messagesContainer.appendChild(messageElement);

    messagesContainer.scrollTop = messagesContainer.scrollHeight;
  });

  socket.on('user connected', (userName) => {
    const userItem = document.createElement('li');
    userItem.textContent = userName;
    onlineUsersList.appendChild(userItem);
  });

  socket.on('user disconnected', (userName) => {
    const userItems = onlineUsersList.getElementsByTagName('li');
    for (const userItem of userItems) {
      if (userItem.textContent === userName) {
        userItem.remove();
        break;
      }
    }
  });

</script>
</body>
</html>
